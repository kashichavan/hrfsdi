{% extends 'base.html' %}
{% load custom_filters %}
{% load static %}

{% block title %}Assign Students{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
<style>
    *, *::before, *::after {
        box-sizing: border-box;
    }

    body {
        overflow-x: hidden;
    }

    .assign-students-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    .requirement-card {
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        margin-bottom: 30px;
    }

    .requirement-header {
        background: linear-gradient(135deg, #ff7700, #ff9933);
        color: white;
        padding: 20px;
        margin: 0;
    }

    .requirement-details {
        padding: 20px;
        background-color: #f9fafb;
    }

    .detail-item {
        margin-bottom: 12px;
    }

    .detail-label {
        font-weight: 600;
        color: #6b7280;
        min-width: 120px;
        display: inline-block;
    }

    .detail-value {
        color: #374151;
    }

    .filter-card {
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        margin-bottom: 25px;
    }

    .filter-header {
        background-color: #f3f4f6;
        padding: 15px 20px;
        border-bottom: 1px solid #e5e7eb;
        font-weight: 600;
    }

    .filter-body {
        padding: 20px;
    }

    .student-table-container {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        background: white;
    }

    .table-responsive {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    .student-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-bottom: 0;
        min-width: 1200px;
    }

    .student-table thead th {
        background-color: #1f2937;
        color: white;
        padding: 15px;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.5px;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .student-table tbody td {
        padding: 12px 15px;
        vertical-align: middle;
        border-top: 1px solid #f3f4f6;
    }

    .student-table tbody tr:hover {
        background-color: #f8f9fa;
    }

    .checkbox-cell {
        width: 40px;
        text-align: center;
    }

    .checkbox-lg {
        width: 18px;
        height: 18px;
        margin: 0;
        cursor: pointer;
    }

    .percentage-cell {
        font-weight: 600;
        color: #374151;
    }

    .gender-badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 8px;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .gender-male {
        background-color: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
    }

    .gender-female {
        background-color: rgba(236, 72, 153, 0.1);
        color: #ec4899;
    }

    .type-badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .req-count {
        display: inline-flex;
        align-items: center;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 500;
        background-color: #f3f4f6;
    }

    .req-count.high {
        background-color: rgba(239, 68, 68, 0.1);
        color: #ef4444;
    }

    .select-all-container {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 15px;
        background: #f8f9fa;
        border-bottom: 1px solid #e5e7eb;
    }

    .assign-btn-container {
        position: sticky;
        bottom: 0;
        background-color: white;
        padding: 15px;
        border-top: 1px solid #e5e7eb;
        text-align: right;
        z-index: 5;
    }

    .no-students {
        padding: 50px;
        text-align: center;
        color: #6b7280;
    }

    .no-students i {
        font-size: 2rem;
        margin-bottom: 15px;
        color: #d1d5db;
    }

    .pagination {
        padding: 15px;
        background: #f8f9fa;
        border-top: 1px solid #e5e7eb;
    }

    .pagination .page-item .page-link {
        border: none;
        color: #4b5563;
        margin: 0 2px;
        border-radius: 6px;
    }

    .pagination .page-item.active .page-link {
        background-color: #1f2937;
        color: white;
    }

    .pagination .page-item:not(.active) .page-link:hover {
        background-color: #f3f4f6;
    }

    @media (max-width: 992px) {
        .student-table {
            display: block;
            overflow-x: auto;
        }
    }

    @media (max-width: 768px) {
        .requirement-details {
            padding: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            margin-bottom: 5px;
        }

        .filter-body {
            padding: 15px;
        }

        .student-table thead th,
        .student-table tbody td {
            padding: 10px;
            font-size: 0.85rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="assign-students-container">
    <!-- Your HTML from the previous code remains unchanged -->
    {{ block.super }}
</div>
{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
$(document).ready(function() {
    $('#streamSelect').select2({
        theme: 'bootstrap-5',
        placeholder: 'Select streams',
        width: '100%',
        closeOnSelect: false,
        dropdownParent: $('.filter-body')
    });

    $('#selectAll').change(function() {
        var isChecked = this.checked;
        $('.student-checkbox').prop('checked', isChecked).trigger('change');
    });

    $(document).on('change', '.student-checkbox', function() {
        if (!this.checked) {
            $('#selectAll').prop('checked', false);
        } else {
            var allChecked = $('.student-checkbox').length === $('.student-checkbox:checked').length;
            $('#selectAll').prop('checked', allChecked);
        }
        updateAssignButton();
    });

    function updateAssignButton() {
        var count = $('.student-checkbox:checked').length;
        $('#assignBtnText').text(count > 0 ? 
            'Assign ' + count + ' Student' + (count > 1 ? 's' : '') : 
            'Assign Selected Students');
    }

    $('tbody tr').click(function(e) {
        if (!$(e.target).is('a, input, i, .btn') && !$(e.target).parent().is('a, .btn')) {
            var checkbox = $(this).find('.student-checkbox');
            checkbox.prop('checked', !checkbox.prop('checked')).trigger('change');
        }
    });

    updateAssignButton();

    $('.pagination a').each(function() {
        var href = $(this).attr('href');
        if (href) {
            var params = new URLSearchParams(window.location.search);
            params.delete('page');
            
            if (href.includes('?')) {
                $(this).attr('href', href + '&' + params.toString());
            } else {
                $(this).attr('href', href + '?' + params.toString());
            }
        }
    });
});
</script>
{% endblock %}
